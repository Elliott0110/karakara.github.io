<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Karakara — Home</title>
  <meta name="description" content="Simple personal site placeholder for Karakara">
  <style>
    :root{--bg:#0f1724;--card:#0b1220;--accent:#6ee7b7;--accent-2:#60a5fa;--muted:#94a3b8;--maxw:900px}
    *{box-sizing:border-box}
    html{scroll-behavior:smooth}
    body{margin:0;font-family:Inter,Segoe UI,Helvetica,Arial,sans-serif;background:linear-gradient(180deg,#071025 0%,#081226 100%);color:#e6eef6;display:flex;flex-direction:column;align-items:center;min-height:100vh}
    .wrap{width:100%;max-width:var(--maxw);padding:24px}
    header{display:flex;justify-content:space-between;align-items:center;padding:12px 0}
    .brand{display:flex;gap:12px;align-items:center}
    .logo{width:48px;height:48px;border-radius:10px;background:linear-gradient(135deg,var(--accent),var(--accent-2));display:inline-block;flex:0 0 48px}
    .logo.animated{animation:logoFloat 4s ease-in-out infinite}
    @keyframes logoFloat{0%{transform:translateY(0) rotate(0)}50%{transform:translateY(-6px) rotate(4deg)}100%{transform:translateY(0) rotate(0)}}
    nav{display:flex;gap:12px;align-items:center}
    nav a{color:var(--muted);text-decoration:none;margin-left:8px;padding:6px 8px;border-radius:8px}
    nav a:hover{color:#fff;background:rgba(255,255,255,0.03)}
    .social{display:flex;gap:8px;margin-left:12px}
    .hero{display:grid;grid-template-columns:1fr;gap:20px;align-items:center;padding:28px 0}
    .card{background:rgba(255,255,255,0.02);padding:18px;border-radius:12px;border:1px solid rgba(255,255,255,0.03);transition:transform .22s ease,box-shadow .22s ease}
    .card:hover{transform:translateY(-6px) scale(1.01);box-shadow:0 8px 30px rgba(2,6,23,0.6)}
    h1{margin:0;font-size:32px}
    p.lead{color:var(--muted);margin:12px 0 0}
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:16px;margin-top:16px}
    .input-row{display:flex;gap:8px;align-items:center;margin-top:8px}
    .input-row .input{flex:1;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit}
    .btn-small{padding:8px 10px;border-radius:8px;background:rgba(255,255,255,0.03);border:none;color:var(--muted);cursor:pointer}
    .btn-small.primary{background:var(--accent);color:#022426;font-weight:600}
    .error{color:#ffb4b4;margin-top:8px}
    .loading{color:var(--muted);margin-top:8px}
    .small{font-size:14px;color:var(--muted)}
    footer{width:100%;text-align:center;padding:20px 0;color:var(--muted);margin-top:28px}
    .muted{color:var(--muted)}
    .tag{display:inline-block;padding:6px 10px;background:rgba(255,255,255,0.02);border-radius:999px;font-size:13px}
    @media (max-width:900px){.grid{grid-template-columns:1fr}.wrap{padding:18px}h1{font-size:26px}}
    @media (max-width:700px){.wrap{padding:16px}h1{font-size:22px}}
    .btn{display:inline-block;padding:8px 14px;background:var(--accent);color:#022426;border-radius:8px;text-decoration:none;font-weight:600}

    /* Reveal animations */
    .reveal{opacity:0;transform:translateY(12px);transition:opacity .6s ease,transform .6s ease}
    .reveal.visible{opacity:1;transform:translateY(0)}

    /* simple timeline */
    .timeline{display:flex;flex-direction:column;gap:12px}
    .timeline-item{display:flex;gap:12px;align-items:flex-start}
    .dot{width:10px;height:10px;border-radius:50%;background:var(--accent);margin-top:6px}
  </style>
  <link rel="icon" href="data:;base64,iVBORw0KGgo=">
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brand">
        <span class="logo" aria-hidden="true"></span>
        <div>
          <div style="font-weight:700">Karakara</div>
          <div class="small">Personal site</div>
        </div>
      </div>
      <nav>
        <a href="#about">About</a>
        <a href="#projects">Projects</a>
        <a href="#experience">Experience</a>
        <a href="#contact">Contact</a>
        <span class="social">
          <a href="https://github.com/" aria-label="GitHub" title="GitHub" target="_blank" rel="noopener" style="color:var(--muted)">GitHub</a>
        </span>
      </nav>
    </header>

    <section class="hero card" id="home">
      <div>
        <h1>Hello — I’m Karakara</h1>
        <p class="lead">A simple, fast, and readable placeholder webpage. Use this as a starting point for your static site or GitHub Pages project.</p>
        <p style="margin-top:14px"><a class="btn" href="#projects">See projects</a></p>
      </div>
      <div class="small" style="text-align:right">Last updated: 2025</div>
    </section>

    <section class="card" id="about" style="margin-top:16px">
      <h2 style="margin:0 0 8px">About</h2>
      <p class="small">This is a minimal template: responsive layout, accessible markup, and a clean default theme. Customize colors, typography, and sections to fit your needs.</p>
    </section>

    <section id="projects" style="margin-top:16px">
      <h2 style="margin:0 0 8px">Projects</h2>
      <div class="grid">
        <div class="card reveal">
          <strong>Project One — Static Site</strong>
          <p class="small">A responsive static site template built for speed and readability. Ideal for GitHub Pages and personal portfolios.</p>
          <p class="small"><span class="tag">HTML</span> <span class="tag">CSS</span></p>
        </div>
        <div class="card reveal">
          <strong>Project Two — Mini App</strong>
          <p class="small">Interactive demo app with lightweight JS and accessibility-first design. Includes testing and CI examples.</p>
          <p class="small"><span class="tag">JavaScript</span> <span class="tag">Testing</span></p>
        </div>
        <div class="card reveal">
          <strong>Project Three — Tooling</strong>
          <p class="small">Utilities and scripts to automate small workflows. Documented and easy to adapt.</p>
          <p class="small"><span class="tag">CLI</span> <span class="tag">Automation</span></p>
        </div>
      </div>
    </section>

    <section id="experience" style="margin-top:16px">
      <h2 style="margin:0 0 8px">Experience</h2>
      <div class="card timeline reveal">
        <div class="timeline-item">
          <div class="dot" aria-hidden="true"></div>
          <div>
            <strong>2023–2025 — Freelance Developer</strong>
            <div class="small muted">Built websites, small apps, and automation scripts for clients.</div>
          </div>
        </div>
        <div class="timeline-item">
          <div class="dot" aria-hidden="true"></div>
          <div>
            <strong>2020–2022 — Open Source Contributor</strong>
            <div class="small muted">Contributed to documentation, bug fixes, and small features across several projects.</div>
          </div>
        </div>
      </div>
    </section>

    <section class="card" id="contact" style="margin-top:16px">
      <h2 style="margin:0 0 8px">Contact</h2>
      <p class="small">Say hello — <a href="mailto:hello@example.com" style="color:var(--accent)">hello@example.com</a></p>
    </section>

    <section id="gallery" style="margin-top:16px">
      <h2 style="margin:0 0 8px">Gallery</h2>
      <div class="card" id="gallery-card">
        <p class="small">Images are loaded from a backend endpoint. Upload new images via the backend to have them appear here.</p>
        <div class="input-row">
          <input id="gallery-server" class="input" placeholder="Server URL (e.g. http://localhost:3000) — leave blank to use relative /api/images" />
          <input id="gallery-folder" class="input" placeholder="Optional Drive folder ID (overrides server default)" value="12Ksg3saeVQxY9uKL3i8eM3XqjdE-qsvm" />
          <button id="gallery-load" class="btn-small primary">Load</button>
        </div>
        <div class="input-row" style="margin-top:8px">
          <input id="drive-api-key" class="input" placeholder="Google API Key (optional — for client Drive API listing)" />
          <button id="drive-load-api" class="btn-small">Load From Drive API</button>
        </div>
        <div style="margin-top:8px">
          <div class="small muted">Client-only: paste Google Drive file links or IDs below (files must be shared "Anyone with the link can view").</div>
          <div class="small muted" style="margin-top:6px">Server-mode: the Drive folder <a href="https://drive.google.com/drive/folders/12Ksg3saeVQxY9uKL3i8eM3XqjdE-qsvm?usp=sharing" target="_blank" rel="noopener" style="color:var(--accent)">12Ksg3saeVQxY9uKL3i8eM3XqjdE-qsvm</a> is prefilled — run the gallery server and click "Load" to fetch images from that folder.</div>
          <textarea id="drive-links" placeholder="Paste Drive share links or file IDs, one per line" style="width:100%;margin-top:8px;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit;height:90px"></textarea>
          <div style="display:flex;gap:8px;margin-top:8px">
            <button id="drive-add" class="btn-small">Add Images</button>
            <button id="drive-clear" class="btn-small">Clear</button>
          </div>
        </div>
        <div id="gallery-status" class="loading" style="display:none">Loading images…</div>
        <div id="gallery-error" class="error" style="display:none"></div>
        <div id="gallery-grid" class="grid" style="margin-top:12px"></div>
        <div id="gallery-empty" class="small muted" style="display:none;margin-top:8px">No images yet. Upload one using the backend.</div>
      </div>
    </section>

    <footer>
      <div class="small">© 2025 Elliott — Built with a tiny template.</div>
    </footer>
  </div>

  <script>
    // Small UX helpers: reveal on scroll + smooth link behavior
    (function(){
      const prefersReduced = window.matchMedia('(prefers-reduced-motion: reduce)').matches;

      // Reveal elements with IntersectionObserver, fall back to on-load for older browsers
      function setupReveal(){
        const items = document.querySelectorAll('.reveal');
        if(!items.length) return;
        if(prefersReduced){
          items.forEach(el=>el.classList.add('visible'));
          return;
        }
        if('IntersectionObserver' in window){
          const obs = new IntersectionObserver((entries, o)=>{
            entries.forEach(e => {
              if(e.isIntersecting){
                e.target.classList.add('visible');
                o.unobserve(e.target);
              }
            });
          },{threshold:0.12});
          items.forEach(i=>obs.observe(i));
        } else {
          // fallback
          window.addEventListener('load', ()=>items.forEach(i=>i.classList.add('visible')));
        }
      }

      // Smooth-scroll for nav links (extra handling for older browsers)
      function setupNav(){
        document.querySelectorAll('a[href^="#"]').forEach(a=>{
          a.addEventListener('click', (e)=>{
            const href = a.getAttribute('href');
            if(href && href.startsWith('#')){
              const target = document.querySelector(href);
              if(target){
                e.preventDefault();
                target.scrollIntoView({behavior:'smooth',block:'start'});
                history.replaceState(null,'',href);
              }
            }
          });
        });
      }

      // tiny initial animation: add logo class after paint
      function kickLogo(){
        const logo = document.querySelector('.logo');
        if(logo) requestAnimationFrame(()=>logo.classList.add('animated'));
      }

      document.addEventListener('DOMContentLoaded', ()=>{
        setupReveal();
        setupNav();
        kickLogo();
      });
    })();
  </script>

  <script>
    // Gallery client: fetch /api/images (JSON array of {url,thumb?}) and render grid.
    // This supports supplying a Server URL (e.g. http://localhost:3000) and optional Drive folderId.
    (function(){
      const grid = document.getElementById('gallery-grid');
      const empty = document.getElementById('gallery-empty');
      const status = document.getElementById('gallery-status');
      const errorEl = document.getElementById('gallery-error');
      const serverInput = document.getElementById('gallery-server');
      const folderInput = document.getElementById('gallery-folder');
      const loadBtn = document.getElementById('gallery-load');
      const apiKeyInput = document.getElementById('drive-api-key');
      const driveLoadApiBtn = document.getElementById('drive-load-api');

      function normalizeServer(u){
        if(!u) return '';
        // remove trailing slash
        return u.replace(/\/$/, '');
      }

      function makeEndpoint(){
        const server = normalizeServer(serverInput.value || '');
        const folder = (folderInput.value || '').trim();
        let ep = server ? (server + '/api/images') : '/api/images';
        if(folder){
          // append folderId as query param
          const sep = ep.includes('?') ? '&' : '?';
          ep = ep + sep + 'folderId=' + encodeURIComponent(folder);
        }
        return ep;
      }

      function createCard(img){
        const el = document.createElement('div');
        el.className = 'card reveal';
        el.style.cursor = 'pointer';
        const thumb = document.createElement('img');
        thumb.src = img.thumb || img.url;
        thumb.alt = img.alt || img.name || 'Gallery image';
        thumb.loading = 'lazy';
        thumb.style.width = '100%';
        thumb.style.height = 'auto';
        thumb.style.borderRadius = '8px';
        thumb.style.display = 'block';
        el.appendChild(thumb);
        el.addEventListener('click', ()=>openLightbox(img));
        return el;
      }

      function openLightbox(img){
        let overlay = document.getElementById('lightbox-overlay');
        if(!overlay){
          overlay = document.createElement('div');
          overlay.id = 'lightbox-overlay';
          overlay.style.position = 'fixed';
          overlay.style.left = 0; overlay.style.top = 0; overlay.style.right = 0; overlay.style.bottom = 0;
          overlay.style.background = 'rgba(2,6,23,0.9)';
          overlay.style.display = 'flex';
          overlay.style.alignItems = 'center';
          overlay.style.justifyContent = 'center';
          overlay.style.padding = '20px';
          overlay.style.zIndex = 9999;
          overlay.addEventListener('click', ()=>overlay.remove());
          const imgEl = document.createElement('img');
          imgEl.id = 'lightbox-img';
          imgEl.style.maxWidth = '92%';
          imgEl.style.maxHeight = '92%';
          imgEl.style.borderRadius = '10px';
          imgEl.style.boxShadow = '0 12px 40px rgba(2,6,23,0.8)';
          overlay.appendChild(imgEl);
          document.body.appendChild(overlay);
        }
        const imgEl = document.getElementById('lightbox-img');
        // if server returned proxied url like /api/image/:id and user provided server URL, make absolute
        const server = normalizeServer(serverInput.value || '');
        if(server && img.url && img.url.startsWith('/')){
          imgEl.src = server + img.url;
        } else {
          imgEl.src = img.url;
        }
      }

      async function loadGallery(){
        errorEl.style.display = 'none';
        status.style.display = 'block';
        status.textContent = 'Loading images…';
        grid.innerHTML = '';
        const ep = makeEndpoint();
        try{
          // If no server configured but an API key is provided, try client Drive API first
          const server = normalizeServer(serverInput.value || '');
          const apiKey = (apiKeyInput && apiKeyInput.value || '').trim();
          const folder = (folderInput.value || '').trim();
          if(!server && apiKey && folder){
            try{
              const driveItems = await fetchDriveFiles(apiKey, folder);
              render(driveItems);
              return;
            }catch(apiErr){
              console.warn('Drive API client fetch failed', apiErr);
              // continue to try server endpoints/fallbacks
            }
          }

          let res = await fetch(ep, {cache:'no-store'});

          // If requested endpoint returned 404 and no explicit server was given,
          // try the common local server fallback at http://localhost:3000
          if(res && res.status === 404 && !(serverInput.value || '').trim()){
            const fallbackServer = 'http://localhost:3000';
            const folder = (folderInput.value || '').trim();
            const localEp = fallbackServer + '/api/images' + (folder ? ('?folderId=' + encodeURIComponent(folder)) : '');
            try{
              const r2 = await fetch(localEp, {cache:'no-store'});
              if(r2 && r2.ok){
                const items = await r2.json();
                // ensure proxied relative urls are absolute to fallbackServer
                const fixed = (items || []).map(i=>({
                  ...i,
                  url: i.url && i.url.startsWith('/') ? (fallbackServer + i.url) : i.url,
                  thumb: i.thumb && i.thumb.startsWith('/') ? (fallbackServer + i.thumb) : i.thumb
                }));
                render(fixed);
                return;
              }
            }catch(e){
              // ignore and fall through to error handling below
              console.warn('Local fallback fetch failed', e);
            }
          }

          if(!res.ok) throw new Error('Server returned ' + (res.status || 'network error'));
          const items = await res.json();
          render(items);
        }catch(err){
          console.error('Gallery load error', err);
          errorEl.style.display = 'block';
          errorEl.textContent = 'Failed to load images: ' + err.message;
          // try fallback images if present
          render(FALLBACK_IMAGES);
        }finally{
          status.style.display = 'none';
        }
      }

      // Fetch Drive files using the public Drive REST API and an API key.
      // Returns array of {url,thumb,name}
      async function fetchDriveFiles(apiKey, folderId){
        if(!apiKey) throw new Error('API key required');
        if(!folderId) throw new Error('Folder ID required');
        const q = encodeURIComponent(`'${folderId}' in parents and mimeType contains 'image/' and trashed = false`);
        const url = `https://www.googleapis.com/drive/v3/files?q=${q}&fields=files(id,name,mimeType,thumbnailLink)&pageSize=200&key=${encodeURIComponent(apiKey)}`;
        const res = await fetch(url);
        if(!res.ok) {
          const txt = await res.text().catch(()=>null);
          throw new Error(`Drive API error ${res.status} ${txt||''}`);
        }
        const data = await res.json();
        const files = data.files || [];
        return files.map(f=>({
          url: `https://drive.google.com/uc?export=view&id=${f.id}`,
          thumb: f.thumbnailLink || `https://drive.google.com/uc?export=view&id=${f.id}`,
          name: f.name
        }));
      }

      function render(items){
        grid.innerHTML = '';
        if(!items || !items.length){
          empty.style.display = 'block';
          return;
        }
        empty.style.display = 'none';
        items.forEach(img=>{
          const card = createCard(img);
          grid.appendChild(card);
          requestAnimationFrame(()=>card.classList.add('visible'));
        });
      }

      const FALLBACK_IMAGES = [
        {url:'https://via.placeholder.com/1200x800.png?text=Sample+1',thumb:'https://via.placeholder.com/600x400.png?text=Sample+1'},
        {url:'https://via.placeholder.com/1200x800.png?text=Sample+2',thumb:'https://via.placeholder.com/600x400.png?text=Sample+2'},
        {url:'https://via.placeholder.com/1200x800.png?text=Sample+3',thumb:'https://via.placeholder.com/600x400.png?text=Sample+3'}
      ];

      // --- Client-only Drive support (Option A) ---
      const driveLinksTextarea = document.getElementById('drive-links');
      const driveAddBtn = document.getElementById('drive-add');
      const driveClearBtn = document.getElementById('drive-clear');

      // Parse possible Drive file IDs from pasted text/URLs
      function parseDriveIds(text){
        const ids = [];
        if(!text) return ids;
        const parts = text.split(/\r?\n/).map(s=>s.trim()).filter(Boolean);
        parts.forEach(p=>{
          // patterns: /file/d/FILE_ID, id=FILE_ID, open?id=FILE_ID, direct file id
          let m = p.match(/file\/d\/([a-zA-Z0-9_-]+)/);
          if(m && m[1]){ ids.push(m[1]); return; }
          m = p.match(/[?&]id=([a-zA-Z0-9_-]+)/);
          if(m && m[1]){ ids.push(m[1]); return; }
          m = p.match(/open\?id=([a-zA-Z0-9_-]+)/);
          if(m && m[1]){ ids.push(m[1]); return; }
          // folder links (skip)
          if(p.includes('/drive/folders/')) return;
          // otherwise, if the whole line looks like an id
          m = p.match(/^([a-zA-Z0-9_-]{10,})$/);
          if(m && m[1]){ ids.push(m[1]); return; }
        });
        return Array.from(new Set(ids)); // unique
      }

      // Convert a Drive file id to a direct-view URL that works when file is shared publicly
      function driveViewUrl(id){
        return 'https://drive.google.com/uc?export=view&id=' + encodeURIComponent(id);
      }

      driveAddBtn.addEventListener('click', (e)=>{
        e.preventDefault();
        const text = driveLinksTextarea.value;
        const ids = parseDriveIds(text);
        if(!ids.length){
          errorEl.style.display = 'block';
          errorEl.textContent = 'No Drive file IDs found. Paste share URLs or IDs (one per line).';
          return;
        }
        // build items and render them at the front
        const items = ids.map(id=>({url: driveViewUrl(id), thumb: driveViewUrl(id), name: id}));
        // prepend to grid
        empty.style.display = 'none';
        items.forEach(img=>{
          const card = createCard(img);
          grid.insertBefore(card, grid.firstChild);
          requestAnimationFrame(()=>card.classList.add('visible'));
        });
        // clear error and textarea
        errorEl.style.display = 'none';
        driveLinksTextarea.value = '';
      });

      driveClearBtn.addEventListener('click', (e)=>{
        e.preventDefault();
        driveLinksTextarea.value = '';
        errorEl.style.display = 'none';
      });

      loadBtn.addEventListener('click', (e)=>{
        e.preventDefault();
        loadGallery();
      });

      // wire the "Load From Drive API" button to use the same loader
      driveLoadApiBtn.addEventListener('click', (e)=>{
        e.preventDefault();
        // ensure server field is empty so loader will try API key first
        serverInput.value = '';
        loadGallery();
      });

      // Auto-load behavior: allow passing API key in URL as ?driveKey=API_KEY
      // or ?apiKey=API_KEY. This enables automatic loading on GitHub Pages without clicking.
      (function autoLoadFromUrl(){
        try{
          const params = new URLSearchParams(window.location.search);
          const k = params.get('driveKey') || params.get('apiKey') || params.get('key');
          if(k){
            apiKeyInput.value = k;
            // If folder param provided in URL, set it
            const f = params.get('folderId') || params.get('folder');
            if(f) folderInput.value = f;
            // Automatically load using the API key
            // Delay slightly to allow the rest of DOM handlers to initialize
            setTimeout(()=>{
              // Clear server input so client API is preferred
              serverInput.value = '';
              loadGallery();
            }, 150);
          } else {
            // If no API key param, still attempt the normal automatic load (server/local)
            // This is already done on DOMContentLoaded; nothing extra needed.
          }
        }catch(e){/* ignore */}
      })();

      // Load on start using default (relative) endpoint. If you want to use server at localhost:3000,
      // type it into the Server URL field and press Load.
      document.addEventListener('DOMContentLoaded', ()=>{
        // try load automatically once
        loadGallery();
      });
    })();
  </script>
</body>
</html>
